
==========================================================================================
RF-CPSS TEST: Paper-conform implementation with Random Forest
==========================================================================================

Changes from old implementation:
  1. q is FIXED (not adaptive)
  2. RF selects exactly q features on each subsample
  3. Permutation importance + feature-type weighting
  4. NO invalid unimodality tests
  5. Only worst-case bound (always valid)
==========================================================================================
DRUG: Erlotinib (RF-CPSS, paper-conform)
==========================================================================================

Expected biomarkers (7):
  - MUT__EGFR: EGFR mutations (primary target)
  - CNV__EGFR: EGFR amplification
  - TPM__EGFR: EGFR expression
  - MUT__KRAS: KRAS resistance
  - MUT__BRAF: BRAF resistance
  - TPM__MET: MET bypass
  - CNV__MET: MET amplification

Data: n=821, d=489, l=24, q=96

Running paper-conform RF-CPSS with B=50 pairs...
Running CPSS with B=50 pairs, target q=96, method=rf
  Pair 1/50...Traceback (most recent call last):
  File "/Users/Julius/Library/Mobile Documents/com~apple~CloudDocs/Studium/Informatik/Bachelorarbeit/Rep/GDSC2_TwoPath_Experiment/scripts/test_rf_cpss_corrected.py", line 148, in <module>
    strong, weak, total = test_drug(drug, markers, B=50)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/Julius/Library/Mobile Documents/com~apple~CloudDocs/Studium/Informatik/Bachelorarbeit/Rep/GDSC2_TwoPath_Experiment/scripts/test_rf_cpss_corrected.py", line 69, in test_drug
    selection_probs, feature_names = cpss_with_fixed_q(
                                     ^^^^^^^^^^^^^^^^^^
  File "/Users/Julius/Library/Mobile Documents/com~apple~CloudDocs/Studium/Informatik/Bachelorarbeit/Rep/GDSC2_TwoPath_Experiment/scripts/cpss_corrected.py", line 263, in cpss_with_fixed_q
    y_A1 = y_arr[A1]
           ~~~~~^^^^
  File "/Applications/anaconda3/lib/python3.12/site-packages/pandas/core/frame.py", line 4108, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Applications/anaconda3/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6200, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/Applications/anaconda3/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6249, in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
KeyError: "None of [Index([609, 174,  67, 168, 275, 335, 807,  86, 539, 713,\n       ...\n       318, 762, 144, 591, 730, 788, 599, 369, 268, 581],\n      dtype='int64', length=410)] are in the [columns]"
